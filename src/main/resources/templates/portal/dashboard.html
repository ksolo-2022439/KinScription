<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Dashboard del Participante</title>
</head>
<body>
<main layout:fragment="content">
    <header class="main-header">
        <h1>Bienvenido al Portal de Inscripción</h1>
        <p>Sigue los pasos a continuación para completar tu proceso.</p>
    </header>

    <div th:if="${successMessage}" class="flash-success">
        <p th:text="${successMessage}"></p>
    </div>

    <section class="progress-steps">
        <div class="progress-line-bg"></div>
        <div class="progress-line-fg" th:style="'width: ' + ${progressPercentage} + '%;'"></div>

        <!-- PASO 1: Examen -->
        <!-- Activo si el estado es PENDIENTE_EXAMEN o EXAMEN_REALIZADO. Completado si es posterior. -->
        <div class="step"
             th:classappend="${participante.estado.name() == 'PENDIENTE_EXAMEN' or participante.estado.name() == 'EXAMEN_REALIZADO'} ? 'active'
                        : (${participante.estado.name() != 'DESAPROBADO'} ? 'completed' : '')">
            <div class="circle">
                <span class="step-number">1</span>
                <svg class="step-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <p>Examen</p>
        </div>

        <!-- PASO 2: Socioeconómico -->
        <div class="step"
             th:classappend="${participante.estado.name() == 'ADMITIDO_EXAMEN' or participante.estado.name() == 'SOCIOECONOMICO_ENVIADO'} ? 'active'
                        : (${#lists.contains({'PENDIENTE_EXAMEN', 'EXAMEN_REALIZADO', 'DESAPROBADO'}, participante.estado.name())} ? '' : 'completed')">
            <div class="circle">
                <span class="step-number">2</span>
                <svg class="step-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <p>Socioeconómico</p>
        </div>

        <!-- PASO 3: Papelería -->
        <div class="step"
             th:classappend="${participante.estado.name() == 'ADMITIDO_FORMULARIO' or participante.estado.name() == 'PAPELERIA_ENVIADA'} ? 'active'
                        : (${#lists.contains({'PENDIENTE_EXAMEN', 'EXAMEN_REALIZADO', 'ADMITIDO_EXAMEN', 'SOCIOECONOMICO_ENVIADO', 'ADMITIDO_SOCIOECONOMICO', 'DESAPROBADO'}, participante.estado.name())} ? '' : 'completed')">
            <div class="circle">
                <span class="step-number">3</span>
                <svg class="step-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <p>Papelería</p>
        </div>

        <!-- PASO 4: Contrato -->
        <div class="step"
             th:classappend="${participante.estado.name() == 'ADMITIDO_PAPELERIA' or participante.estado.name() == 'CONTRATO_ENVIADO'} ? 'active'
                        : (${participante.estado.name() == 'FINALIZADO' or participante.estado.name() == 'ADMITIDO_CONTRATO'} ? 'completed' : '')">
            <div class="circle">
                <span class="step-number">4</span>
                <svg class="step-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <p>Contrato</p>
        </div>

        <!-- PASO 5: Finalizado -->
        <div class="step" th:classappend="${participante.estado.name() == 'FINALIZADO'} ? 'completed' : ''">
            <div class="circle">
                <span class="step-number">5</span>
                <svg class="step-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <p>Finalizado</p>
        </div>
    </section>

    <section class="content-cards" th:switch="${participante.estado.name()}">

        <div th:case="'PENDIENTE_EXAMEN'" class="card active">
            <h3>Evaluación de Ingreso</h3>
            <p>Este es el primer paso. Debes realizar tu examen de admisión en la fecha y hora programadas para
                continuar.</p>
            <div class="card-details">
                <span><strong>Fecha:</strong> 25 de Octubre, 2025</span>
                <span><strong>Hora:</strong> 9:00 AM</span>
            </div>
            <a th:href="@{/portal/examen}" class="btn-primary">Iniciar Examen</a>
        </div>

        <div th:case="'EXAMEN_REALIZADO'" class="card waiting">
            <h3>Examen Entregado</h3>
            <p>Hemos recibido tu evaluación. Nuestro personal administrativo la calificará pronto. Por favor, mantente
                atento a las actualizaciones en este portal.</p>
        </div>

        <div th:case="'ADMITIDO_EXAMEN'" class="card active">
            <h3>Formulario Socioeconómico</h3>
            <p>¡Felicidades, aprobaste el examen! Ahora, por favor completa el formulario socioeconómico. Esta
                información es confidencial y se usará para definir tus cuotas.</p>
            <a th:href="@{/portal/socioeconomico}" class="btn-primary">Llenar Formulario</a>
        </div>

        <div th:case="'SOCIOECONOMICO_ENVIADO'" class="card waiting">
            <h3>Formulario en Revisión</h3>
            <p>Hemos recibido tu formulario socioeconómico. Nuestro personal lo está revisando y te notificaremos cuando
                el proceso continúe.</p>
        </div>

        <div th:case="'ADMITIDO_SOCIOECONOMICO'" class="card waiting">
            <h3>Formulario en Revisión</h3>
            <p>Tu formulario ha sido aprobado por Dirección. Ahora está siendo revisado por el área de Orientación.
                Espera la confirmación final.</p>
        </div>

        <div th:case="'ADMITIDO_FORMULARIO'" class="card active">
            <h3>Entrega de Papelería</h3>
            <p>Tu solicitud ha sido aprobada. El siguiente paso es subir los documentos requeridos a la plataforma.</p>
            <a th:href="@{/portal/papeleria}" class="btn-primary">Subir Documentos</a>
        </div>

        <div th:case="'PAPELERIA_ENVIADA'" class="card waiting">
            <h3>Papelería en Revisión</h3>
            <p>Hemos recibido tus documentos. Secretaría los está revisando para asegurar que todo esté en orden.</p>
        </div>

        <div th:case="'ADMITIDO_PAPELERIA'" class="card active">
            <h3>Firma de Contrato</h3>
            <p>Tu expediente está completo. Descarga el contrato, fírmalo con la ayuda de un abogado y súbelo en formato
                PDF para finalizar.</p>
            <a th:href="@{/portal/contrato}" class="btn-primary">Gestionar Contrato</a>
        </div>

        <div th:case="'CONTRATO_ENVIADO'" class="card waiting">
            <h3>Contrato en Revisión</h3>
            <p>¡Ya casi terminas! Hemos recibido tu contrato y lo estamos revisando para la aprobación final.</p>
        </div>

        <div th:case="'FINALIZADO'" class="card completed">
            <h3>¡Has sido admitido oficialmente!</h3>
            <p>
                ¡Felicidades y bienvenido a la comunidad académica de KinScription! Tu proceso de inscripción ha
                finalizado con éxito.
                A continuación, encontrarás tus credenciales de acceso para el **Campus Principal**.
            </p>

            <div class="credentials-box">
                <p><strong>Correo Institucional:</strong> <span th:text="${alumno.emailAcademico}"></span></p>
                <p><strong>Contraseña Temporal:</strong> <span>password123</span></p>
            </div>
            <small><strong>Importante:</strong> Debes cambiar tu contraseña en tu primer inicio de sesión en el Campus
                Principal por seguridad.</small>

            <div class="final-actions">
                <form th:action="@{/logout}" method="post" style="margin: 0;">
                    <button type="submit" class="btn-primary">Cerrar Sesión del Portal</button>
                    <a href="#" class="btn-secondary">Ir al Campus Principal</a>
                </form>
            </div>
        </div>
    </section>
</main>
</body>
</html>